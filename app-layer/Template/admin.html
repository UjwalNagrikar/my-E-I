<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Admin Dashboard</h2>
            <a href="/admin/logout" class="btn btn-outline-danger">Logout</a>
        </div>

        <div class="row mb-4">
            <div class="col-md-4"><div class="card p-3 bg-primary text-white">Total: <h3 id="stat-total">0</h3></div></div>
            <div class="col-md-4"><div class="card p-3 bg-success text-white">Today: <h3 id="stat-today">0</h3></div></div>
            <div class="col-md-4"><div class="card p-3 bg-warning">This Week: <h3 id="stat-week">0</h3></div></div>
        </div>

        <table class="table bg-white shadow-sm">
            <thead><tr><th>Date</th><th>Name</th><th>Message</th><th>Action</th></tr></thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>

    <script>
        async function loadData() {
            const res = await fetch('/admin/api/data');
            const data = await res.json();
            
            document.getElementById('stat-total').innerText = data.stats.total;
            document.getElementById('stat-today').innerText = data.stats.today;
            document.getElementById('stat-week').innerText = data.stats.week;

            const tbody = document.getElementById('table-body');
            tbody.innerHTML = data.queries.map(q => `
                <tr id="row-${q.id}">
                    <td>${q.created_at}</td>
                    <td>${q.name}</td>
                    <td>${q.message}</td>
                    <td><button onclick="deleteEntry(${q.id})" class="btn btn-danger btn-sm">Delete</button></td>
                </tr>
            `).join('');
        }

        async function deleteEntry(id) {
            if(confirm('Delete?')) {
                await fetch(`/admin/api/delete/${id}`, {method:'POST'});
                document.getElementById(`row-${id}`).remove();
            }
        }
        window.onload = loadData;
    </script>
</body>
</html>